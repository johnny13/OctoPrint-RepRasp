/*! RepRasp https://www.huement.com/reprasp 2015-08-22 */
function startindex(){$("#printer_connect").on("click",function(a){a.preventDefault(),getstatus()}),getstatus()}function startcontrols(){controlstartlimit++,xyz_clicks(),mmspinner(),homerow_clicks(),$(".measured_amount .btn").on("click",function(a){a.preventDefault(),$(".measured_amount .btn").removeClass("active"),$(this).addClass("active")})}function mmspinner(){var a;$(".number-spinner button").mousedown(function(){btn=$(this),input=btn.closest(".number-spinner").find("input"),btn.closest(".number-spinner").find("button").prop("disabled",!1),a="up"==btn.attr("data-dir")?setInterval(function(){void 0==input.attr("max")||parseInt(input.val())<parseInt(input.attr("max"))?input.val(parseInt(input.val())+5):(btn.prop("disabled",!0),clearInterval(a))},50):setInterval(function(){void 0==input.attr("min")||parseInt(input.val())>parseInt(input.attr("min"))?input.val(parseInt(input.val())-5):(btn.prop("disabled",!0),clearInterval(a))},50)}).mouseup(function(){clearInterval(a)})}function homerow_clicks(){$(".home_x").on("click",function(a){a.preventDefault();var b={command:"home",axes:["x"]};homeaxis(b)}),$(".home_y").on("click",function(a){a.preventDefault();var b={command:"home",axes:["y"]};homeaxis(b)}),$(".home_z").on("click",function(a){a.preventDefault();var b={command:"home",axes:["z"]};homeaxis(b)})}function xyz_clicks(){$(".plus_x").on("click",function(a){a.preventDefault();var b=$(".measured_amount .active").data("amount"),c=parseInt(b,10);movedirection(c,0,0)}),$(".minus_x").on("click",function(a){a.preventDefault();var b=$(".measured_amount .active").data("amount"),c=parseInt("-"+b,10);movedirection(c,0,0)}),$(".plus_y").on("click",function(a){a.preventDefault();var b=$(".measured_amount .active").data("amount"),c=parseInt(b,10);movedirection(0,c,0)}),$(".minus_y").on("click",function(a){a.preventDefault();var b=$(".measured_amount .active").data("amount"),c=parseInt("-"+b,10);movedirection(0,c,0)}),$(".plus_z").on("click",function(a){a.preventDefault();var b=$(".measured_amount .active").data("amount"),c=parseInt(b,10);movedirection(0,0,c)}),$(".minus_z").on("click",function(a){a.preventDefault();var b=$(".measured_amount .active").data("amount"),c=parseInt("-"+b,10);movedirection(0,0,c)})}function movedirection(a,b,c){var d=GlobalURL+"/api/printer/printhead",e={command:"jog",x:a,y:b,z:c},f=JSON.stringify(e);$.ajax({type:"post",url:d,dataType:"json",data:f,contentType:"application/json",headers:{"X-Api-Key":GlobalKey},success:function(a){console.debug(a)},error:function(a){console.debug(a),MumfordNote("API ERROR. Command Incomplete",!1,"error")}})}function homeaxis(a){var b=GlobalURL+"/api/printer/printhead",c=JSON.stringify(a);$.ajax({type:"post",url:b,dataType:"json",data:c,contentType:"application/json",headers:{"X-Api-Key":GlobalKey},success:function(a){},error:function(a){console.debug(a),MumfordNote("API ERROR. Command Incomplete",!1,"error")}})}function getstatus(){var a=GlobalURL+"/api/connection";console.debug(a),$.ajax({type:"GET",url:a,dataType:"JSON",headers:{"X-Api-Key":GlobalKey},success:function(a){console.debug(a),void 0!==a.current&&void 0!==a.current.state&&($("#mac_state").text(a.current.state),"Operational"==a.current.state&&($(".status_panel").removeClass("panel-default").addClass("panel-success"),$(".status_lead ").addClass("alert-success")))},error:function(a){console.debug(a),$(".status_panel").removeClass("panel-default").addClass("panel-danger"),$(".status_lead ").addClass("alert-danger"),$("#mac_state").text("unreachable"),$("#printer_connect").html("<i class='fa fa-retweet'></i> Connect").removeClass("btn-danger").addClass("btn-default")}})}function start_page(){var a=$.jStorage.get("lastpage11");if(null==a||void 0==a||""==a){var b="status",c=b+".html";LoadNewPage(c,b)}else{var b=a,c=b;LoadNewPage(c,b)}}function LoadThisPage(){$(".navmenu-fixed-right").hasClass("in")===!0&&$(".action-button").trigger("click");var a=currentpageid;"status.html"==a?startindex():"control.html"==a?startcontrols():startindex()}function getURLParameters(a){var b={},c=a.indexOf("?");if(-1==c)return b;for(var d=a.substring(c+1),e=d.split("&"),f=0;f<e.length;f++){var g=e[f].split("=");b[g[0]]=g[1]}return b}function someFunction(a){return a.replace(/\/$/,"")}function loadurl(){var a=document.URL,b=getURLParameters(a);if(console.debug(b),80==document.location.port||"80"==document.location.port||""==document.location.port||void 0==document.location.port)GlobalURL=someFunction(document.location.protocol+"//"+document.location.hostname+document.location.pathname);else{var c=document.location.protocol+"//"+document.location.hostname+":"+document.location.port+document.location.pathname;console.debug(document.location.port),GlobalURL=someFunction(c)}if(null==b.apikey||void 0==b.apikey||""==b.apikey){var d=$.jStorage.get("apikey");null==d||void 0==d||""==d?MumfordNote("Error. ?apikey= not set.",!1,"error","true"):(GlobalKey=d,start_page())}else{$.jStorage.set("apikey",b.apikey);GlobalKey=b.apikey,start_page()}}function LoadNewPage(a,b){console.debug(a),currentpageid=b;var c=GlobalURL+"/"+a+"?apikey="+GlobalKey;console.debug(c),$.ajax({type:"post",url:c,dataType:"html",contentType:"text/html",success:function(a){console.debug(a),GlobalContainer.html(a),$.jStorage.set("lastpage11",currentpageid),setTimeout("LoadThisPage()",250)},error:function(a){console.debug(a),MumfordNote("API ERROR. Page Not Loaded.",!1,"error")}})}var controlstartlimit=0,GlobalURL="octopi.local:5000",GlobalKey="",GlobalDebug=0,GlobalContainer=$("#reprasp_main"),currentpageid="",configmode="url";$(document).ready(function(){$(".minset li a").on("click",function(a){a.preventDefault();var b=$(this).data("pageid"),c=b+".html";LoadNewPage(c,b)}),"file"==configmode?configfile():loadurl()});